<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhishSim Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body, html {margin:0; padding:0; width:100%; height:100%; font-family:'Poppins',sans-serif; background:#0d0d0d; color:#fff; overflow-x:hidden;}
header {position:absolute; top:20px; left:30px; font-family:'Orbitron',sans-serif; font-size:32px; font-weight:700; color:#00ffff; display:flex; align-items:center;}
header img {height:40px; margin-right:10px;}
.container {width:90%; max-width:1400px; margin:0 auto; padding-top:100px; text-align:center;}
.tabs {margin-bottom:40px;}
.tab-btn {background:#111; color:#00ffff; border:none; padding:12px 25px; margin:0 10px; cursor:pointer; font-size:16px; border-radius:6px; transition:0.3s; font-family:'Orbitron',sans-serif; white-space:nowrap;}
.tab-btn:hover, .tab-btn.active {background:linear-gradient(90deg,#00ffff,#ff00ff); color:#000;}
.tab-content {display:none; animation:fadeIn 0.5s; text-align:center;}
.tab-content.active {display:block;}
.upload-box {border:2px dashed #00ffff; padding:40px; border-radius:15px; cursor:pointer; margin:20px auto; background:rgba(0,255,255,0.05); transition:0.3s; max-width:700px; word-break:break-word;}
.upload-box:hover {background:rgba(0,255,255,0.1);}
textarea,input[type="text"],input[type="email"],select {width:80%; max-width:700px; padding:12px; margin:10px 0; border-radius:8px; border:none; font-size:14px; background:#111; color:#0ff; word-wrap:break-word;}
button {padding:12px 25px; margin-top:10px; font-family:'Orbitron',sans-serif; font-size:16px; font-weight:600; color:#000; background:#0ff; border:none; border-radius:8px; cursor:pointer; transition:0.3s;}
button:hover {background:#0ff; filter:brightness(1.2);}
.cards {display:grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:20px; margin-top:20px;}
.card {background:#111; padding:20px; border-radius:15px; width:100%; min-height:120px; text-align:left; box-shadow:0 0 20px rgba(0,255,255,0.2); transition:0.3s; word-wrap:break-word;}
.card h3 {color:#0ff; margin-bottom:10px; font-size:18px;}
.card p {font-size:14px; color:#fff; overflow-wrap:break-word;}
#loading {display:none; font-size:18px; margin-top:20px; color:#ff0; font-weight:700; text-shadow:0 0 5px #ff0; animation:blink 1s infinite;}
@keyframes blink {0%,50%,100%{opacity:1;} 25%,75%{opacity:0;}}
@keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
canvas#sparkleCanvas {position:fixed; top:0; left:0; z-index:-1;}
.stats-container canvas, #campaignChart {max-width: 800px; width: 90%; height: 400px; margin: 0 auto; display: block;}
@media(max-width:768px){.cards{grid-template-columns:1fr;} textarea,input,select{width:95%;}}
.header-logo {
  position: fixed;
  top: 20px;
  left: 30px;
  display: flex;
  align-items: center;
  font-family: 'Rajdhani', sans-serif;
  font-weight: 300;
  font-size: 16px;
  color: #00fff7;
  z-index: 10;
  text-shadow: 0 0 10px #00fff7, 0 0 20px #00fff7, 0 0 30px #00fff7;
  animation: flicker 2s infinite;
}

.header-logo .logo-svg {
  width: 30px;
  height: 30px;
  margin-right: 12px;
  filter: drop-shadow(0 0 5px #00fff7) drop-shadow(0 0 10px #0ff);
}

</style>
</head>
<body>

<!-- Header with logo + text -->
<div class="header-logo">
  <!-- Inbuilt SVG logo -->
  <svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path fill="#00fff7" d="M12 2L2 7v5c0 5.55 3.84 10.74 10 13 6.16-2.26 10-7.45 10-13V7l-10-5z"/>
    <path fill="#0ff" d="M12 12l4-4-4-4-4 4 4 4z"/>
  </svg>
  <span>PhishSim</span>
</div>


<canvas id="sparkleCanvas"></canvas>

<div class="container">
  <div class="tabs">
    <button class="tab-btn active" onclick="showTab(event, 'scan')">Email Scan</button>
    <button class="tab-btn" onclick="showTab(event, 'demo')">Demo Analysis</button>
    <button class="tab-btn" onclick="showTab(event, 'campaign')">Campaign Simulation</button>
    <button class="tab-btn" onclick="showTab(event, 'stats')">Phishing Stats</button>
  </div>

  <!-- Email Scan -->
  <div id="scan" class="tab-content active">
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
      <h3>ðŸ“¤ Upload Email (.eml)</h3>
      <p>or click to select a file</p>
      <input type="file" id="fileInput" style="display:none" onchange="uploadEmail(this)">
    </div>
    <textarea id="emailText" rows="10" placeholder="Or paste full email content here..."></textarea><br>
    <button onclick="analyzeText()">Analyze Email</button>
    <div id="loading">Analyzing...</div>
    <div class="cards" id="results"></div>
  </div>

  <!-- Demo Analysis -->
  <div id="demo" class="tab-content">
    <button onclick="demoAnalysis()">Run Demo Phishing Analysis</button>
    <div class="cards" id="demoResults"></div>
  </div>

  <!-- Campaign Simulation -->
  <div id="campaign" class="tab-content">
    <form id="emailCampaignForm">
      <input type="email" id="senderEmail" placeholder="Sender Email" required>
      <input type="text" id="subject" placeholder="Subject" required>
      <textarea id="messageBody" placeholder="Message Body" required></textarea>
      <input type="text" id="recipients" placeholder="Recipient Emails (comma-separated)" required>
      <button type="submit">Send Campaign</button>
    </form>
    <div class="stats-container">
      <canvas id="campaignChart"></canvas>
    </div>
  </div>

  <!-- Phishing Stats -->
  <div id="stats" class="tab-content">
    <div class="stats-container">
      <canvas id="phishingChart"></canvas>
    </div>
  </div>
</div>

<script>
function showTab(event, tabId){
  document.querySelectorAll(".tab-content").forEach(d => d.classList.remove("active"));
  document.getElementById(tabId).classList.add("active");
  document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
  event.currentTarget.classList.add("active");
  
  // Render Phishing Stats chart only when stats tab is active
  if(tabId === 'stats') renderStatsChart();
}

// Email Scan & Demo Analysis
async function uploadEmail(input){
  const file=input.files[0]; if(!file) return;
  const formData=new FormData(); formData.append("file", file);
  document.getElementById("loading").style.display="block";
  const res = await fetch("/upload",{method:"POST",body:formData});
  const data = await res.json();
  document.getElementById("loading").style.display="none";
  displayResults(data,"results");
}
function analyzeText(){
  const text=document.getElementById("emailText").value;
  if(!text) return alert("Paste email content!");
  document.getElementById("loading").style.display="block";
  setTimeout(()=>{document.getElementById("loading").style.display="none"; displayResults(simulatePhishingAnalysis(text),"results");},800);
}
function simulatePhishingAnalysis(content){
  let score=0, suspicious=[], brands=[];
  const keywords=["password","login","verify","bank","click","urgent"];
  keywords.forEach(k=>{if(content.toLowerCase().includes(k)){score+=2; suspicious.push(k);}});
  if(content.toLowerCase().includes("paypal")) brands.push("PayPal");
  let verdict="CLEAN"; if(score>=4) verdict="SUSPICIOUS"; if(score>=8) verdict="MALICIOUS";
  return {phishing_score:score, verdict:verdict, confidence:(score/10).toFixed(2), explanation:"Simulated phishing analysis based on keywords.", suspicious_elements:suspicious, identified_brands:brands};
}
function displayResults(data, containerId){
  const container=document.getElementById(containerId);
  container.innerHTML="";
  let html="";
  html+=`<div class="card"><h3>Phishing Score</h3><p>${data.phishing_score}</p></div>`;
  html+=`<div class="card"><h3>Verdict</h3><p>${data.verdict}</p></div>`;
  html+=`<div class="card"><h3>Confidence</h3><p>${data.confidence}</p></div>`;
  html+=`<div class="card"><h3>Explanation</h3><p>${data.explanation}</p></div>`;
  container.innerHTML=html;
}
function demoAnalysis(){
  const sample=["Phishing email with urgent login request","Normal newsletter","Bank verification alert"];
  document.getElementById("demoResults").innerHTML="";
  sample.forEach(s=>{displayResults(simulatePhishingAnalysis(s),"demoResults");});
}
document.getElementById("emailCampaignForm").onsubmit=function(e){e.preventDefault(); alert("Simulation sent (demo)!");};

// Charts
let statsChartRendered=false;
function renderStatsChart(){
  if(statsChartRendered) return;
  statsChartRendered=true;
  const statsCtx = document.getElementById('phishingChart').getContext('2d');
  new Chart(statsCtx,{
    type:'line',
    data:{
      labels:['2019','2020','2021','2022','2023','2024','2025'],
      datasets:[{label:'Phishing Attacks', data:[779200,1845814,2847773,4744699,5000000,6000000,7000000], borderColor:'#4e54c8', backgroundColor:'rgba(78,84,200,0.3)', tension:0.4, fill:true}]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{labels:{color:'#fff'}}},
      scales:{x:{ticks:{color:'#fff'},grid:{color:'#444'}},y:{ticks:{color:'#fff'},grid:{color:'#444'}}}
    }
  });
}
const campaignCtx=document.getElementById("campaignChart").getContext("2d");
new Chart(campaignCtx,{
  type:'pie',
  data:{labels:["CLEAN","SUSPICIOUS","MALICIOUS"], datasets:[{data:[45,25,30], backgroundColor:['#0f0','#ff0','#f00']}]},
  options:{plugins:{legend:{labels:{color:'#fff'}}}}
});

// Sparkle Background
const canvas=document.getElementById("sparkleCanvas"), ctx2=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
let particles=[]; for(let i=0;i<120;i++){particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:Math.random()*2+1, speed:Math.random()*0.5+0.2});}
canvas.addEventListener("mousemove",e=>{particles.forEach(p=>{let dx=p.x-e.clientX, dy=p.y-e.clientY, dist=Math.sqrt(dx*dx+dy*dy); if(dist<100){p.x+=dx*0.02; p.y+=dy*0.02;}});});
function animate(){ctx2.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{ctx2.beginPath(); ctx2.arc(p.x,p.y,p.size,0,2*Math.PI); ctx2.fillStyle="#0ff"; ctx2.fill(); p.y-=p.speed; if(p.y<0){p.y=canvas.height; p.x=Math.random()*canvas.width;}}); requestAnimationFrame(animate);}
animate();
</script>
</body>
</html>
